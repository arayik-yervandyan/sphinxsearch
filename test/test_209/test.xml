<?xml version="1.0" encoding="utf-8"?>
<test>

<name>like operator</name>

<config>
indexer
{
  mem_limit   = 16M
}

searchd
{
  <searchd_settings/>
  workers = threads
}

source src
{
  type      = mysql
  <sql_settings/>
  sql_query     = SELECT document_id, group_id, group_id2, title, content FROM test_table
  sql_attr_uint   = group_id
  sql_attr_uint   = group_id2
}

index test
{
  source      = src
  path      = <data_path/>/test
  charset_type  = utf-8
}

source src10
{
  type      = mysql
  <sql_settings/>
  sql_query     = SELECT document_id, group_id, group_id2, title, content FROM test_table where document_id in (1,2)
  sql_attr_uint   = group_id
  sql_attr_uint   = group_id2
}

index test10
{
  source      = src10
  path      = <data_path/>/test10
}
source src11
{
  type      = mysql
  <sql_settings/>
  sql_query     = SELECT document_id, group_id, group_id2, title, content FROM test_table where document_id in (3,4)
  sql_attr_uint   = group_id
  sql_attr_uint   = group_id2
}

index test11
{
  source      = src11
  path      = <data_path/>/test11
}
index dist1
{
	type =distributed
	agent = <my_address/>:test10
	agent = <my_address/>:test11
}

source src20
{
  type      = mysql
  <sql_settings/>
  sql_query     = SELECT document_id, group_id, group_id2, title, content FROM test_table where document_id in (1,3)
  sql_attr_uint   = group_id
  sql_attr_uint   = group_id2
}

index test20
{
  source      = src20
  path      = <data_path/>/test20
}
source src21
{
  type      = mysql
  <sql_settings/>
  sql_query     = SELECT document_id, group_id, group_id2, title, content FROM test_table where document_id in (2,4)
  sql_attr_uint   = group_id
  sql_attr_uint   = group_id2
}

index test21
{
  source      = src21
  path      = <data_path/>/test21
}
index dist2
{
	type =distributed
	agent = <my_address/>:test20
	agent = <my_address/>:test21
}
</config>

<sphqueries>
<sphinxql>SHOW STATUS LIKE '%n_\_up%'</sphinxql>
<sphinxql>SHOW META LIKE '%al%found'</sphinxql>
<sphinxql>DESCRIBE test LIKE 'g_oup%'</sphinxql>
<sphinxql>SHOW TABLES LIKE '__s_'</sphinxql>
<sphinxql>SHOW AGENT STATUS LIKE '%seconds%'</sphinxql>

<sphinxql>SELECT *, GROUPBY(), COUNT(*) FROM test GROUP BY group_id, group_id2</sphinxql>
<sphinxql>SELECT *, GROUPBY(), COUNT(*) FROM test GROUP BY group_id2, group_id, group_id2</sphinxql>
<sphinxql>SELECT COUNT(*) FROM test</sphinxql>
<sphinxql>SELECT id id1, COUNT(DISTINCT id1) FROM test</sphinxql>

<!--regression group by multi vs distributed -->
<sphinxql>SELECT *, GROUPBY(), COUNT(*) FROM dist1 GROUP BY group_id, group_id2</sphinxql>
<sphinxql>SELECT *, GROUPBY(), COUNT(*) FROM dist1 GROUP BY group_id2, group_id, group_id2</sphinxql>
<sphinxql>SELECT *, GROUPBY(), COUNT(*) FROM dist2 GROUP BY group_id, group_id2</sphinxql>
<sphinxql>SELECT *, GROUPBY(), COUNT(*) FROM dist2 GROUP BY group_id2, group_id, group_id2</sphinxql>

</sphqueries>

<db_create>
CREATE TABLE test_table
(
  document_id INTEGER PRIMARY KEY NOT NULL AUTO_INCREMENT,
  group_id  INTEGER NOT NULL,
  group_id2 INTEGER NOT NULL,
  title   VARCHAR(255) NOT NULL,
  content   VARCHAR(255) NOT NULL
)
</db_create>

<db_drop>
DROP TABLE IF EXISTS test_table
</db_drop>

<db_insert>
INSERT INTO test_table ( document_id, group_id, group_id2, title, content ) VALUES
  ( 1, 1, 5, 'test one', 'this is my test document number one. also checking search within phrases.' ),
  ( 2, 1, 6, 'test two', 'this is my test document number two' ),
  ( 3, 2, 7, 'test three', 'this is another group' ),
  ( 4, 2, 8, 'test four', 'this is to test groups' )
</db_insert>

</test>
